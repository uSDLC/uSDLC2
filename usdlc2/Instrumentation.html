<html>
<head>
	<title></title>
	<link href="document.css" rel="stylesheet" type="text/css" />
</head>
<body class="scayt-enabled">
<h1 style="">Instrumentation</h1>

<h2 style="">Given, When, Then</h2>

<p><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee">server = gwt.server()

gwt.rules(
  /a number between (\d+) and (\d+)/, (start, end) -&gt;
    @number = +start + Math.floor(Math.random() *
                                  (+end - +start))
    @test(@number &lt; 10, @number)
    
  /multiply the number by (\d+)/, (multiplicand) -&gt;
    @number *= multiplicand
    @pass(@number)

  /the result is an even number/, -&gt;
    @test not (@number % 2), @number
)</textarea></p>

<p style="display: block;"><em><strong>uSDLC</strong></em> will process any set of natural language&nbsp;statements in a GWT block. New blocks can be created with the target icon on the uSDLC tab.</p>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="metadata"><a href="javascript:usdlc.edit_source({value:'metadata.coffee',path:'client/ckeditor/metadata.coffee',category:'ckeditor'})">metadata.coffee</a></span></div>

<h3 style="">A Basic Example</h3>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<p style="display: block;">Instrumentation&nbsp;consists of a GWT block (below) and the instrumentation bridge code. You can view the code at any time by right-clicking on the GWT block and selecting &quot;<em>Bridge</em>&quot;. Bridge code is broken up into a block for each&nbsp;heading leading&nbsp;to the current section. In this way&nbsp;common code is available between sections.</p>

<pre style="display: block;" type="gwt">
Given a number between 1 and 10
When we multiply the number by 2
Then the result is an even number
</pre>

<p>More than one GWT block can reside in each section. They are concatenated for the purposes of instrumentation.</p>

<pre style="width: 454.75px;" type="gwt">
Given a number between 1 and 10
When we multiply the number by 2
Then the result is an even number</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span></div>

<h3 style="">Built-in Rules</h3>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h4 style="">Given a Shell, Fork or Spawn</h4>

<h4 style="">Checking Output Content</h4>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<h5 style="">Checking Output by Substring</h5>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<p style="display: block;">Instrumentation captures output from actions and running sub-systems. Sometimes this is the best way to measure a response. For simplicity you can scan the output for a substring.</p>

<pre style="display: block;" type="gwt">
Given a number between 1 and 10
Then the response includes &#39;ecking Output Co&#39;</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span></div>

<h5 style="">Checking Output by Regular Expression</h5>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<p style="display: block;">For more complicated checks&nbsp;nothing beats regular expressions. They are, however, less readable.</p>

<pre style="display: block;" type="gwt">
Given a number between 1 and 10
Then response matches /.*ok 1 - \d/</pre>

<div class="metadata Ref">Ref: <span class="index"><a href="javascript:usdlc.edit_source({value:'index.coffee',path:'server/gwt/index.coffee',category:'gwt'})">index.coffee</a></span><span class="base"><a href="javascript:usdlc.edit_source({value:'base.coffee',path:'server/gwt/base.coffee',category:'gwt'})">base.coffee</a></span></div>

<h3 style="">Child Process Output</h3>

<pre style="display: block;" type="gwt">
Given a shell
When we execute &#39;echo uSDLC child output test&#39;
Then the response includes &#39;uSDLC child output test&#39;</pre>

<h2>The Bridge</h2>

<p>The bridge is code that connects rules to the operational system and other external resources. It is recorded within the document and extracted to be run. Any&nbsp;GWT block can access bridge code from it&#39;s section and all connected parent sections.</p>

<p><textarea readonly="readonly" source="true" type="gwt.coffee"></textarea></p>

<div class="metadata Ref">Ref: <span class="gwt"><a href="javascript:usdlc.edit_source({value:'gwt.coffee',path:'client/ckeditor/gwt.coffee',category:'ckeditor'})">gwt.coffee</a></span><span class="gwt_coffee"><a href="javascript:usdlc.edit_source({value:'gwt_coffee.coffee',path:'client/ckeditor/gwt_coffee.coffee',category:'ckeditor'})">gwt_coffee.coffee</a></span><span class="metadata"><a href="javascript:usdlc.edit_source({value:'metadata.coffee',path:'client/ckeditor/metadata.coffee',category:'ckeditor'})">metadata.coffee</a></span></div>

<h3>The&nbsp;<em>gwt</em>&nbsp;Object</h3>

<h3>Rules</h3>

<h3>Asynchronous Support</h3>

<p>A rule is complete when it is marked pass or fail.&ccedil; Each rule has a queue for&nbsp;&nbsp;asynchronous operations. Each queue entry&nbsp;will complete and allow the next to start when @pass() is called. If there are no more steps, @pass() will complete the rule as usual. If @fail is called all further steps are skipped and the rule fails.</p>

<pre type="gwt">
A rule with steps
A rule that would fail mid-step if we permitted it
</pre>

<div class="metadata Ref">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="base"><a href="javascript:usdlc.edit_source({value:'base.coffee',path:'server/gwt/base.coffee',category:'gwt'})">base.coffee</a></span><span class="index"><a href="javascript:usdlc.edit_source({value:'index.coffee',path:'server/gwt/index.coffee',category:'gwt'})">index.coffee</a></span><span class="gwt"><a href="javascript:usdlc.edit_source({value:'gwt.coffee',path:'drivers/gwt.coffee',category:'drivers'})">gwt.coffee</a></span><span class="files"><a href="javascript:usdlc.edit_source({value:'files.coffee',path:'server/http/files.coffee',category:'http'})">files.coffee</a></span></div>

<p><textarea readonly="readonly" source="true" type="gwt.coffee">count = 0

# async function that waits 1/10th of a sec then checks value
# should fail if another piece of code races ahead
heartbeat = (expects) -&gt; gwt.queue -&gt;
  tick = -&gt;
    gwt.expect(count++, expects)
  setTimeout(tick, 100)

gwt.rules(
  /A rule with steps/, -&gt;
    heartbeat 0
    heartbeat 1
    heartbeat 2
  
  /A rule that would fail mid-step/, -&gt;
    @expect_failure = true
    
    @queue -&gt;
      count = 0
      @pass()
      
    heartbeat 0
    heartbeat 5
    heartbeat 2
)</textarea></p>
</body>
</html>
