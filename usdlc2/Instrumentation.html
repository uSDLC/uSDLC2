<html>
<head>
	<title></title>
	<link href="document.css" rel="stylesheet" type="text/css" />
</head>
<body class="scayt-enabled">
<h1 style="">Instrumentation</h1>

<h2 style="">Given, When, Then</h2>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee">server = gwt.server()

gwt.rules(
  /a number between (\d+) and (\d+)/, (start, end) -&gt;
    @number = +start + Math.floor(Math.random() *
                                  (+end - +start))
    @test(@number &lt; 10, @number)
    
  /multiply the number by (\d+)/, (multiplicand) -&gt;
    @number *= multiplicand
    @pass(@number)

  /the result is an even number/, -&gt;
    @test not (@number % 2), @number
)</textarea></p>

<p style="display: block;"><em><strong>uSDLC</strong></em> will process any set of natural language&nbsp;statements in a GWT block. New blocks can be created with the target icon on the uSDLC tab - given&nbsp;a type of <em>gwt</em>.</p>

<div class="metadata Ref" style="display: block;">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="index"><a href="javascript:usdlc.edit_source({value:'index.coffee',path:'server/gwt/index.coffee',category:'gwt'})">index.coffee</a></span><span class="gwt"><a href="javascript:usdlc.edit_source({value:'gwt.coffee',path:'scripts/gwt.coffee',category:'scripts'})">gwt.coffee</a></span><span class="instrument"><a href="javascript:usdlc.edit_source({value:'instrument.coffee',path:'instrument.coffee',category:'.'})">instrument.coffee</a></span><span class="processes"><a href="javascript:usdlc.edit_source({value:'processes.coffee',path:'server/gwt/processes.coffee',category:'gwt'})">processes.coffee</a></span></div>

<h3 style="">A Basic Example</h3>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<p style="display: block;">Instrumentation&nbsp;consists of a GWT block (below) and the instrumentation bridge code. You can view the code at any time by right-clicking on the&nbsp;GWT block and selecting &quot;<em>Bridge</em>&quot;. Bridge code is broken up into&nbsp;a block for each&nbsp;heading leading&nbsp;to the current section. In this way&nbsp;common code is available between sections.</p>

<pre style="display: block;" type="gwt">
Given a number between 1 and 10
When we multiply the number by 2
Then the result is an even number
</pre>

<p style="display: block;">More than one GWT block can reside in each section. They are concatenated for the purposes of instrumentation.</p>

<pre style="width: 454.75px; display: block;" type="gwt">
Given a number between 1 and 10
When we multiply the number by 2
Then the result is an even number</pre>

<div class="metadata Ref" style="display: block;">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="script_extractor"><a href="javascript:usdlc.edit_source({value:'script_extractor.coffee',path:'server/script_extractor.coffee',category:'server'})">script_extractor.coffee</a></span><span class="base"><a href="javascript:usdlc.edit_source({value:'base.coffee',path:'server/gwt/base.coffee',category:'gwt'})">base.coffee</a></span><span class="init"><a href="javascript:usdlc.edit_source({value:'init.coffee',path:'init.coffee',category:'.'})">init.coffee</a></span><span class="processes"><a href="javascript:usdlc.edit_source({value:'processes.coffee',path:'server/gwt/processes.coffee',category:'gwt'})">processes.coffee</a></span><span class="server"><a href="javascript:usdlc.edit_source({value:'server.coffee',path:'server/gwt/server.coffee',category:'gwt'})">server.coffee</a></span><span class="shell"><a href="javascript:usdlc.edit_source({value:'shell.coffee',path:'server/http/shell.coffee',category:'http'})">shell.coffee</a></span><span class="play"><a href="javascript:usdlc.edit_source({value:'play.coffee',path:'client/ckeditor/play.coffee',category:'ckeditor'})">play.coffee</a></span><span class="instrument"><a href="javascript:usdlc.edit_source({value:'instrument.html',path:'instrument.html',category:'.'})">instrument.html</a></span><span class="gwt"><a href="javascript:usdlc.edit_source({value:'gwt.coffee',path:'scripts/gwt.coffee',category:'scripts'})">gwt.coffee</a></span><span class="go"><a href="javascript:usdlc.edit_source({value:'go.sh.bat',path:'go.sh.bat',category:'.'})">go.sh.bat</a></span><span class="bridge"><a href="javascript:usdlc.edit_source({value:'bridge.coffee',path:'client/ckeditor/bridge.coffee',category:'ckeditor'})">bridge.coffee</a></span><span class="code"><a href="javascript:usdlc.edit_source({value:'code.coffee',path:'client/ckeditor/code.coffee',category:'ckeditor'})">code.coffee</a></span></div>

<h3 style="">Built-in Rules</h3>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<h4 style="">Given a Shell, Fork or Spawn</h4>

<h4 style="">Checking Output Content</h4>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<div class="metadata Ref">Ref: <span class="instrument"><a href="javascript:usdlc.edit_source({value:'instrument.coffee',path:'instrument.coffee',category:'.'})">instrument.coffee</a></span><span class="code"><a href="javascript:usdlc.edit_source({value:'code.coffee',path:'client/ckeditor/code.coffee',category:'ckeditor'})">code.coffee</a></span><span class="script_extractor"><a href="javascript:usdlc.edit_source({value:'script_extractor.coffee',path:'server/script_extractor.coffee',category:'server'})">script_extractor.coffee</a></span></div>

<h5 style="">Checking Output by Substring</h5>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<p style="display: block;">Instrumentation captures output from actions and running sub-systems. Sometimes this is the best way to measure a response. For simplicity you can scan the output for a substring.</p>

<pre style="display: block;" type="gwt">
Given a number between 1 and 10
Then the response includes &#39;ecking Output Co&#39;</pre>

<div class="metadata Ref" style="display: block;">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="java"><a href="javascript:usdlc.edit_source({value:'java.coffee',path:'server/gwt/java.coffee',category:'gwt'})">java.coffee</a></span><span class="index"><a href="javascript:usdlc.edit_source({value:'index.coffee',path:'server/gwt/index.coffee',category:'gwt'})">index.coffee</a></span><span class="server"><a href="javascript:usdlc.edit_source({value:'server.coffee',path:'server/gwt/server.coffee',category:'gwt'})">server.coffee</a></span><span class="processes"><a href="javascript:usdlc.edit_source({value:'processes.coffee',path:'server/gwt/processes.coffee',category:'gwt'})">processes.coffee</a></span></div>

<h5 style="">Checking Output by Regular Expression</h5>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<p style="display: block;">For more complicated checks&nbsp;nothing beats regular expressions. They are, however, less readable.</p>

<pre style="display: block;" type="gwt">
Given a number between 1 and 10
Then response matches /.*ok 1 - \d/</pre>

<div class="metadata Ref" style="display: block;">Ref: <span class="metadata"><a href="javascript:usdlc.edit_source({value:'metadata.coffee',path:'client/ckeditor/metadata.coffee',category:'ckeditor'})">metadata.coffee</a></span><span class="bridge"><a href="javascript:usdlc.edit_source({value:'bridge.coffee',path:'client/ckeditor/bridge.coffee',category:'ckeditor'})">bridge.coffee</a></span></div>

<h3 style="">Child Process Output</h3>

<pre style="display: block;" type="gwt">
Given a shell
When we execute &#39;echo uSDLC child output test&#39;
Then the response includes &#39;uSDLC child output test&#39;</pre>

<div class="metadata Ref" style="display: block;">Ref: <span class="app"><a href="javascript:usdlc.edit_source({value:'app.coffee',path:'app.coffee',category:'.'})">app.coffee</a></span><span class="sections"><a href="javascript:usdlc.edit_source({value:'sections.coffee',path:'client/ckeditor/sections.coffee',category:'ckeditor'})">sections.coffee</a></span></div>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<h2>Code and Data</h2>

<p style="display: block;">Given/When/Then is a specific example of a code segment.</p>

<div class="metadata Ref" style="display: block;">Ref: <span class="code"><a href="javascript:usdlc.edit_source({value:'code.coffee',path:'client/ckeditor/code.coffee',category:'ckeditor'})">code.coffee</a></span><span class="autocomplete"><a href="javascript:usdlc.edit_source({value:'autocomplete.coffee',path:'client/autocomplete.coffee',category:'client'})">autocomplete.coffee</a></span><span class="app"><a href="javascript:usdlc.edit_source({value:'app.coffee',path:'app.coffee',category:'.'})">app.coffee</a></span><span class="bridge"><a href="javascript:usdlc.edit_source({value:'bridge.coffee',path:'client/ckeditor/bridge.coffee',category:'ckeditor'})">bridge.coffee</a></span><span class="sections"><a href="javascript:usdlc.edit_source({value:'sections.coffee',path:'client/ckeditor/sections.coffee',category:'ckeditor'})">sections.coffee</a></span></div>

<h2>The Bridge</h2>

<p style="display: block;">The bridge is code that connects rules to the operational system and other external resources. It is recorded within the document and extracted to be run. Any&nbsp;GWT block can access bridge code from it&#39;s section and all connected parent sections.</p>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee"></textarea></p>

<div class="metadata Ref" style="display: block;">Ref:&nbsp;<span class="bridge"><a href="javascript:usdlc.edit_source({value:'bridge.coffee',path:'client/ckeditor/bridge.coffee',category:'ckeditor'})">bridge.coffee</a></span><span class="play"><a href="javascript:usdlc.edit_source({value:'play.coffee',path:'client/ckeditor/play.coffee',category:'ckeditor'})">play.coffee</a></span></div>

<h3>The&nbsp;<em>gwt</em>&nbsp;Object</h3>

<h3>Rules</h3>

<h3>Asynchronous Support</h3>

<p style="display: block;">A rule is complete when it is marked pass or fail.&nbsp;Each rule has a queue for&nbsp;&nbsp;asynchronous operations. Each queue entry&nbsp;will complete and allow the next to start when @pass() is called. If there are no more steps, @pass() will complete the rule as usual. If @fail is called all further steps are skipped and the rule fails.</p>

<pre style="display: block;" type="gwt">
A rule with steps
A rule that would fail mid-step if we permitted it
</pre>

<div class="metadata Ref" style="display: block;">Ref: <span class="Bridge"><a href="javascript:usdlc.bridge_editor()">Bridge</a></span><span class="Play"><a href="javascript:usdlc.play()">Play</a></span><span class="base"><a href="javascript:usdlc.edit_source({value:'base.coffee',path:'server/gwt/base.coffee',category:'gwt'})">base.coffee</a></span><span class="index"><a href="javascript:usdlc.edit_source({value:'index.coffee',path:'server/gwt/index.coffee',category:'gwt'})">index.coffee</a></span><span class="files"><a href="javascript:usdlc.edit_source({value:'files.coffee',path:'server/http/files.coffee',category:'http'})">files.coffee</a></span></div>

<p style="display: block;"><textarea readonly="readonly" source="true" style="display: none;" type="gwt.coffee">count = 0

# async function that waits 1/10th of a sec then checks value
# should fail if another piece of code races ahead
heartbeat = (expects) -&gt; gwt.queue -&gt;
  tick = -&gt;
    gwt.expect(count++, expects)
  setTimeout(tick, 100)

gwt.rules(
  /A rule with steps/, -&gt;
    heartbeat 0
    heartbeat 1
    heartbeat 2
  
  /A rule that would fail mid-step/, -&gt;
    @expect_failure = true
    
    @queue -&gt;
      count = 0
      @pass()
      
    heartbeat 0
    heartbeat 5
    heartbeat 2
)</textarea></p>
</body>
</html>
